<% content_for :title, "Logs & Audit Trail - Private Jet Booking Platform" %>

<div class="flex justify-between items-center mb-6">
  <h2 class="text-xl font-semibold text-yellow-700">Logs & Audit Trail</h2>
  <div class="flex items-center space-x-3">
    <!-- Category Filter -->
    <div class="bg-white rounded-lg border border-gray-200 p-2">
      <%= form_with url: logs_audit_path, method: :get, local: true, class: "inline" do |form| %>
        <%= form.hidden_field :date_range, value: @date_range %>
        <%= form.hidden_field :selected_user, value: @selected_user %>
        <%= form.hidden_field :search, value: @search_term %>
        <%= form.select :filter_type, options_for_select([
          ['All Categories', 'all'],
          ['Request Management', 'request_management'],
          ['Data Access', 'data_access'],
          ['Security', 'security'],
          ['User Management', 'user_management'],
          ['System Maintenance', 'system_maintenance'],
          ['System Configuration', 'system_configuration']
        ], @filter_type), {}, { 
          class: "text-sm border-none bg-transparent outline-none", 
          onchange: "this.form.submit();" 
        } %>
      <% end %>
    </div>
    
    <!-- Date Range Filter -->
    <div class="bg-white rounded-lg border border-gray-200 p-2">
      <%= form_with url: logs_audit_path, method: :get, local: true, class: "inline" do |form| %>
        <%= form.hidden_field :filter_type, value: @filter_type %>
        <%= form.hidden_field :selected_user, value: @selected_user %>
        <%= form.hidden_field :search, value: @search_term %>
        <%= form.select :date_range, options_for_select([
          ['Today', 'today'],
          ['This Week', 'week'],
          ['This Month', 'month'],
          ['This Quarter', 'quarter'],
          ['Custom Range', 'custom']
        ], @date_range), {}, { 
          class: "text-sm border-none bg-transparent outline-none", 
          onchange: "this.form.submit();" 
        } %>
      <% end %>
    </div>
    
    <!-- User Filter -->
    <div class="bg-white rounded-lg border border-gray-200 p-2">
      <%= form_with url: logs_audit_path, method: :get, local: true, class: "inline" do |form| %>
        <%= form.hidden_field :filter_type, value: @filter_type %>
        <%= form.hidden_field :date_range, value: @date_range %>
        <%= form.hidden_field :search, value: @search_term %>
        <%= form.select :selected_user, options_for_select([
          ['All Users', 'all'],
          ['Ahmed Al Rashid', 'Ahmed Al Rashid'],
          ['Fatima Al Zahra', 'Fatima Al Zahra'],
          ['Sarah Al Mansoori', 'Sarah Al Mansoori'],
          ['System', 'System']
        ], @selected_user), {}, { 
          class: "text-sm border-none bg-transparent outline-none", 
          onchange: "this.form.submit();" 
        } %>
      <% end %>
    </div>
    
    <!-- Export Button -->
    <button class="flex items-center text-sm bg-yellow-700 text-white py-2 px-4 rounded-lg hover:bg-yellow-600">
      <i data-lucide="download" class="w-4 h-4 mr-2"></i>
      Export Logs
    </button>
  </div>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-4 gap-6 mb-6">
  <div class="bg-white rounded-xl shadow-sm p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-gray-500">Today's Events</p>
        <p class="text-2xl font-bold text-gray-800"><%= @statistics[:todays_events] %></p>
      </div>
      <i data-lucide="activity" class="w-8 h-8 text-blue-600"></i>
    </div>
  </div>
  <div class="bg-white rounded-xl shadow-sm p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-gray-500">Security Alerts</p>
        <p class="text-2xl font-bold text-red-600"><%= @statistics[:security_alerts] %></p>
      </div>
      <i data-lucide="shield" class="w-8 h-8 text-red-600"></i>
    </div>
  </div>
  <div class="bg-white rounded-xl shadow-sm p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-gray-500">Active Users</p>
        <p class="text-2xl font-bold text-green-600"><%= @statistics[:active_users] %></p>
      </div>
      <i data-lucide="users" class="w-8 h-8 text-green-600"></i>
    </div>
  </div>
  <div class="bg-white rounded-xl shadow-sm p-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-gray-500">Data Access Events</p>
        <p class="text-2xl font-bold text-orange-600"><%= @statistics[:data_access_events] %></p>
      </div>
      <i data-lucide="eye" class="w-8 h-8 text-orange-600"></i>
    </div>
  </div>
</div>

<!-- Audit Logs Table -->
<% content_for :pagination do %>
  <button class="px-3 py-1 border border-gray-200 rounded-l-lg text-sm text-gray-600">Previous</button>
  <button class="px-3 py-1 bg-yellow-700 text-white text-sm">1</button>
  <button class="px-3 py-1 border-y border-r border-gray-200 text-sm text-gray-600">2</button>
  <button class="px-3 py-1 border-y border-r border-gray-200 text-sm text-gray-600 rounded-r-lg">Next</button>
<% end %>

<%= render 'shared/data_table', 
    data: @filtered_logs,
    columns: @audit_table_columns,
    title: 'Audit Events',
    selectable: true,
    expandable: true,
    expand_content: @audit_expand_content,
    empty_message: "No audit events found",
    empty_icon: "file-text",
    total_count: @audit_logs.length,
    table_id: 'logs-audit' %>
